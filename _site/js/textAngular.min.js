if(!window.console)console={log:function(){}};var textAngular=angular.module("textAngular",["ngSanitize"]);textAngular.directive("textAngular",["$compile","$window","$document","$rootScope","$timeout",function(t,e,a,n,l){function i(t,e){for(var a in e){if(e[a]&&e[a].constructor&&e[a].constructor===Object){t[a]=t[a]||{};arguments.callee(t[a],e[a])}else{t[a]=e[a]}}return t}n.textAngularOpts=i({toolbar:[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",textEditor:"form-control",htmlEditor:"form-control"}},n.textAngularOpts!=null?n.textAngularOpts:{});var o=function(t){t=t.toLowerCase();var e=a[0].queryCommandValue("formatBlock").toLowerCase();return e===t||e===t};n.textAngularTools=i({html:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>Toggle HTML</button>",action:function(){var t,e=this;this.$parent.showHtml=!this.$parent.showHtml;if(this.$parent.showHtml){l(function(){return e.$parent.displayElements.html[0].focus()},100)}else{l(function(){return e.$parent.displayElements.text[0].focus()},100)}this.active=this.$parent.showHtml}},h1:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H1</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H1>")},activeState:function(){return o("h1")}},h2:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H2</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H2>")},activeState:function(){return o("h2")}},h3:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H3</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H3>")},activeState:function(){return o("h3")}},p:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>P</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")},activeState:function(){return o("p")}},pre:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>pre</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")},activeState:function(){return o("pre")}},ul:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ul'></i></button>",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)},activeState:function(){return a[0].queryCommandState("insertUnorderedList")}},ol:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ol'></i></button>",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)},activeState:function(){return a[0].queryCommandState("insertOrderedList")}},quote:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-quote-right'></i></button>",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return o("blockquote")}},undo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-undo'></i></button>",action:function(){return this.$parent.wrapSelection("undo",null)}},redo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-repeat'></i></button>",action:function(){return this.$parent.wrapSelection("redo",null)}},bold:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-bold'></i></button>",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return a[0].queryCommandState("bold")}},justifyLeft:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-left'></i></button>",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return a[0].queryCommandState("justifyLeft")}},justifyRight:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-right'></i></button>",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return a[0].queryCommandState("justifyRight")}},justifyCenter:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-center'></i></button>",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return a[0].queryCommandState("justifyCenter")}},italics:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-italic'></i></button>",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return a[0].queryCommandState("italic")}},underline:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-underline'></i></button>",action:function(){return this.$parent.wrapSelection("underline",null)},activeState:function(){return a[0].queryCommandState("underline")}},clear:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-ban'></i></button>",action:function(){return this.$parent.wrapSelection("removeFormat",null)}},insertImage:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-picture-o'></i></button>",action:function(){var t;t=prompt("Please enter an image URL to insert","http://");if(t!=="http://"&&t!==""){return this.$parent.wrapSelection("insertImage",t)}}},insertLink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-link'></i></button>",action:function(){var t;t=prompt("Please enter an URL to insert","http://");if(t!==""){return this.$parent.wrapSelection("createLink",t)}}},unlink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-unlink'></i></button>",action:function(){return this.$parent.wrapSelection("unlink",null)}}},n.textAngularTools!=null?n.textAngularTools:{});return{require:"?ngModel",scope:{},restrict:"EA",link:function(e,i,o,s){var r,c,u,d,p,f,m;angular.extend(e,n.textAngularOpts,{wrapSelection:function(t,a){document.execCommand(t,false,a);if(e.showHtml)e.displayElements.html[0].focus();else e.displayElements.text[0].focus();e.updateSelectedStyles();if(!e.showHtml)e.updateTaBindtext()},showHtml:false});if(!!o.taToolbar)e.toolbar=e.$eval(o.taToolbar);if(!!o.taFocussedClass)e.classes.focussed=e.$eval(o.taFocussedClass);if(!!o.taToolbarClass)e.classes.toolbar=o.taToolbarClass;if(!!o.taToolbarGroupClass)e.classes.toolbarGroup=o.taToolbarGroupClass;if(!!o.taToolbarButtonClass)e.classes.toolbarButton=o.taToolbarButtonClass;if(!!o.taToolbarActiveButtonClass)e.classes.toolbarButtonActive=o.taToolbarActiveButtonClass;if(!!o.taTextEditorClass)e.classes.textEditor=o.taTextEditorClass;if(!!o.taHtmlEditorClass)e.classes.htmlEditor=o.taHtmlEditorClass;var y=i.html();i.html("");e.displayElements={toolbar:angular.element("<div></div>"),forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")};i.append(e.displayElements.toolbar);i.append(e.displayElements.text);i.append(e.displayElements.html);if(!!o.name){e.displayElements.forminput.attr("name",o.name);i.append(e.displayElements.forminput)}if(!!o.taDisabled){e.displayElements.text.attr("ta-readonly","disabled");e.displayElements.html.attr("ta-readonly","disabled");e.disabled=e.$parent.$eval(o.taDisabled);e.$parent.$watch(o.taDisabled,function(t){e.disabled=t;if(e.disabled){i.addClass("disabled")}else{i.removeClass("disabled")}})}t(e.displayElements.text)(e);t(e.displayElements.html)(e);i.addClass("ta-root");e.displayElements.toolbar.addClass("ta-toolbar "+e.classes.toolbar);e.displayElements.text.addClass("ta-text ta-editor "+e.classes.textEditor);e.displayElements.html.addClass("ta-html ta-editor "+e.classes.textEditor);i.on("focusin",function(){i.addClass(e.classes.focussed);l(function(){if(e.showHtml)e.displayElements.html[0].focus();else e.displayElements.text[0].focus()},0)});i.on("focusout",function(){l(function(){if(!(a[0].activeElement===e.displayElements.html[0])&&!(a[0].activeElement===e.displayElements.text[0])){i.removeClass(e.classes.focussed);l(function(){i.triggerHandler("blur")},0)}},0)});e.tools={};for(var b=0;b<e.toolbar.length;b++){r=e.toolbar[b];c=angular.element("<div></div>");c.addClass(e.classes.toolbarGroup);for(var v=0;v<r.length;v++){f=r[v];m=angular.element(n.textAngularTools[f].display);m.addClass(e.classes.toolbarButton);m.attr("unselectable","on");m.attr("tabindex","-1");m.attr("ng-disabled","showHtml()");var g=angular.extend(e.$new(true),n.textAngularTools[f],{name:f,showHtml:function(){if(this.name!=="html")return this.$parent.disabled||this.$parent.showHtml;return this.$parent.disabled},displayActiveToolClass:function(t){return t?this.$parent.classes.toolbarButtonActive:""}});e.tools[f]=g;c.append(t(m)(g))}e.displayElements.toolbar.append(c)}if(o.ngModel){s.$render=function(){e.displayElements.forminput.val(s.$viewValue);if(!(a[0].activeElement===e.displayElements.html[0])&&!(a[0].activeElement===e.displayElements.text[0])){var t=s.$viewValue||"";e.text=t;e.html=t}}}else{e.displayElements.forminput.val(y);e.text=y;e.html=y}e.$watch("text",function(t,a){e.html=t;if(o.ngModel&&t!==a)s.$setViewValue(t);e.displayElements.forminput.val(t)});e.$watch("html",function(t,a){e.text=t;if(o.ngModel&&t!==a)s.$setViewValue(t);e.displayElements.forminput.val(t)});e.bUpdateSelectedStyles=false;e.updateSelectedStyles=function(){for(var t=0;t<e.toolbar.length;t++){var a=e.toolbar[t];for(var n=0;n<a.length;n++){f=a[n];if(e.tools[f].activeState!=null){e.tools[f].active=e.tools[f].activeState.apply(e)}}}if(e.bUpdateSelectedStyles)l(e.updateSelectedStyles,200)};u=function(t){if(!e.bUpdateSelectedStyles){e.bUpdateSelectedStyles=true;e.$apply(function(){e.updateSelectedStyles()})}};e.displayElements.html.on("keydown",u);e.displayElements.text.on("keydown",u);d=function(t){e.bUpdateSelectedStyles=false};e.displayElements.html.on("keyup",d);e.displayElements.text.on("keyup",d);p=function(t){e.$apply(function(){e.updateSelectedStyles()})};e.displayElements.html.on("mouseup",p);e.displayElements.text.on("mouseup",p)}}}]).directive("taBind",["$sanitize","$document","taFixChrome",function(t,e,a){return{require:"ngModel",scope:{taBind:"@"},link:function(n,l,i,o){var s=l[0].tagName.toLowerCase()!=="textarea"&&l[0].tagName.toLowerCase()!=="input"&&l.attr("contenteditable")!==undefined&&l.attr("contenteditable");var r=false;var c=function(){var t=a(l).html();if(n.taBind==="html"&&s)t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return t};n.$parent["updateTaBind"+n.taBind]=function(){var t=c();var e=o.$parsers;o.$parsers=[];o.$oldViewValue=t;o.$setViewValue(t);o.$parsers=e};if(s){l.on("keyup",function(t){if(!r)o.$setViewValue(c())})}function u(e,a){var n;try{n=t(e)}catch(l){n=a||""}return n}o.$parsers.push(function(t){var e=o.$oldViewValue=u(t,o.$oldViewValue);return e});o.$formatters.push(function(t){var e=u(t,"");return e});o.$render=function(){if(e[0].activeElement!==l[0]){var t=o.$viewValue||"";o.$oldViewValue=t;if(n.taBind==="text"){try{angular.element(t).find("script").remove()}catch(a){}l.html(t);l.find("a").on("click",function(t){t.preventDefault();return false})}else if(s||l[0].tagName.toLowerCase()!=="textarea"&&l[0].tagName.toLowerCase()!=="input")l.html(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));else l.val(t)}else if(!s)l.val(t)};if(!!i.taReadonly){if(n.$parent.$eval(i.taReadonly)){if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.attr("disabled","disabled");if(l.attr("contenteditable")!==undefined&&l.attr("contenteditable"))l.removeAttr("contenteditable")}else{if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.removeAttr("disabled");else if(s)l.attr("contenteditable","true")}n.$parent.$watch(i.taReadonly,function(t,e){if(e===t)return;if(t){if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.attr("disabled","disabled");if(l.attr("contenteditable")!==undefined&&l.attr("contenteditable"))l.removeAttr("contenteditable")}else{if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.removeAttr("disabled");else if(s)l.attr("contenteditable","true")}r=t})}}}}]).factory("taFixChrome",function(){var t=function(t){var e=angular.element(t).find("span");for(var a=0;a<e.length;a++){var n=angular.element(e[a]);if(n.attr("style")&&n.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)){if(n.next().length>0&&n.next()[0].tagName==="BR")n.next().remove();n.replaceWith(n.html())}}var l=t.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");if(l!==t.html())t.html(l);return t};return t});